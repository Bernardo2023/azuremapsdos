<!DOCTYPE html>
<html lang="en">
<head>
    <title>Calcular una ruta simple - Ejemplos del SDK web de Azure Maps</title>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Este ejemplo muestra cómo calcular una ruta simple y mostrarla en el mapa utilizando el módulo de Servicios de Azure Maps." />
    <meta name="keywords" content="mapas de Microsoft, mapa, gis, API, SDK, servicios, módulo, ruta, direcciones" />
    <meta name="author" content="Microsoft Azure Maps" />
    <meta name="version" content="1.0" />
    <meta name="screenshot" content="screenshot.jpg" />

    <!-- Agregar referencias a los archivos JavaScript y CSS del control de mapas de Azure Maps. -->
    <link href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.css" rel="stylesheet" />
    <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.js"></script>

    <!-- Agregar una referencia al archivo JavaScript del Módulo de Servicios de Azure Maps. -->
    <script src="https://atlas.microsoft.com/sdk/javascript/service/2/atlas-service.min.js"></script>

    <style>
        .azure-maps-icon {
            width: 50px;
            height: 50px;
        }
    </style>

    <script>
        var map, datasource, routeURL;

        function GetMap() {
            // Inicializar una instancia de mapa.
            map = new atlas.Map('myMap', {
                center:  [-98.193042, 19.046026], // Coordenadas de Puebla, México
                zoom: 13,
                view: 'Auto',
                authOptions: {
                    authType: 'subscriptionKey',
                    subscriptionKey: 'CWfOCbYY2R3bV8CDeqD9biMVp4nqztcIixNYAe1Olxw'
                }
            });

            // Usar MapControlCredential para compartir la autenticación entre un control de mapa y el módulo de servicio.
            var pipeline = atlas.service.MapsURL.newPipeline(new atlas.service.MapControlCredential(map));

            // Construir el objeto RouteURL.
            routeURL = new atlas.service.RouteURL(pipeline);

            // Esperar a que los recursos del mapa estén listos.
            map.events.add('ready', function () {
                datasource = new atlas.source.DataSource();
                map.sources.add(datasource);

                // Crear los objetos GeoJSON que representan los puntos de inicio y fin de la ruta.
                var startPoint2 = new atlas.data.Feature(new atlas.data.Point([-98.15190247952451, 19.05651037601117]), {
                    title: "UTP",
                    icon: "pin-round-blue"
                });

                var endPoint = new atlas.data.Feature(new atlas.data.Point([-98.194260, 19.043536]), {
                    title: "Catedral de Puebla",
                    icon: "pin-blue"
                });
                var startPoint3 = new atlas.data.Feature(new atlas.data.Point([-98.179803, 19.057880]), {
                    title: "Fuerte de Loreto",
                    icon: "pin-round-blue"
                });
                var startPoint = new atlas.data.Feature(new atlas.data.Point([-98.187890, 19.040117]), {
                    title: "Fuente de los Frailes",
                    icon: "pin-round-blue"
                });

                // Agregar los datos a la fuente de datos.
                datasource.add([startPoint, endPoint]);

                // Crear una capa para representar la línea de la ruta debajo de las etiquetas de carretera.
                map.layers.add(new atlas.layer.LineLayer(datasource, null, {
                    strokeColor: '#2272B9',
                    strokeWidth: 5,
                    lineJoin: 'round',
                    lineCap: 'round'
                }), 'labels');

                // Crear una capa para representar los puntos de inicio y fin de la ruta como símbolos.
                map.layers.add(new atlas.layer.SymbolLayer(datasource, null, {
                    iconOptions: {
                        image: ['get', 'icon'],
                        allowOverlap: true,
                        ignorePlacement: true
                    },
                    textOptions: {
                        textField: ['get', 'title'],
                        offset: [0, 1.2]
                    },
                    filter: ['any', ['==', ['geometry-type'], 'Point'], ['==', ['geometry-type'], 'MultiPoint']] // Solo representar puntos o puntos múltiples en esta capa.
                }));

                // Obtener las coordenadas de los puntos de inicio y fin.
                var coordinates = [
                    startPoint.geometry.coordinates, 
                    startPoint2.geometry.coordinates,
                    startPoint3.geometry.coordinates,
                    endPoint.geometry.coordinates
                ];

                // Calcular una ruta.
                routeURL.calculateRouteDirections(atlas.service.Aborter.timeout(10000), coordinates).then((directions) => {
                    // Obtener los datos de la ruta como GeoJSON y agregarlos a la fuente de datos.
                    var data = directions.geojson.getFeatures();
                    datasource.add(data);

                    // Actualizar la vista del mapa para centrarse en la ruta.
                    map.setCamera({
                        bounds: data.bbox,
                        padding: 30 // Agregar un relleno para tener en cuenta el tamaño en píxeles de los símbolos.
                    });
                });
            });
        }
    </script>
</head>
<body onload="GetMap()">
    <div id="myMap" style="position: relative; width: 100%; min-width: 290px; height: 600px;"></div>

    <fieldset style="width: calc(100% - 30px); min-width: 290px; margin-top: 10px;">
        <legend>Calcular una ruta simple</legend>
        Este ejemplo muestra cómo calcular una ruta simple y mostrarla en el mapa utilizando el módulo de Servicios de Azure Maps.
    </fieldset>
</body>
</html>
